import streamlit as st
import pandas as pd
import xml.etree.ElementTree as ET
import hashlib
import io
from datetime import datetime
import re
from collections import defaultdict
import xml.dom.minidom as minidom
import os
import zipfile
import time
import pytz # Importar pytz

#================================================================================
# DADOS INTERNOS
#================================================================================

def carregar_erros_ans():
    """
    Carrega a planilha de erros da ANS que agora est√° embutida no c√≥digo.
    """
    csv_data = """C√≥digo do Termo,Termo
1001,N√öMERO DA CARTEIRA INV√ÅLIDO
1002,N√öMERO DO CART√ÉO NACIONAL DE SA√öDE INV√ÅLIDO
1003,A ADMISS√ÉO DO BENEFICI√ÅRIO NO PRESTADOR OCORREU ANTES DA INCLUS√ÉO DO BENEFICI√ÅRIO NA OPERADORA
1004,SOLICITA√á√ÉO ANTERIOR √Ä INCLUS√ÉO DO BENEFICI√ÅRIO
1005,ATENDIMENTO ANTERIOR √Ä INCLUS√ÉO DO BENEFICI√ÅRIO
1006,ATENDIMENTO AP√ìS O DESLIGAMENTO DO BENEFICI√ÅRIO
1007,ATENDIMENTO DENTRO DA CAR√äNCIA DO BENEFICI√ÅRIO
1008,ASSINATURA DIVERGENTE
1009,BENEFICI√ÅRIO COM PAGAMENTO EM ABERTO
1010,ASSINATURA DO TITULAR / RESPONS√ÅVEL INEXISTENTE
1011,IDENTIFICA√á√ÉO DO BENEFICI√ÅRIO N√ÉO CONSISTENTE
1012,SERVI√áO PROFISSIONAL HOSPITALAR N√ÉO √â COBERTO PELO PLANO DO BENEFICI√ÅRIO
1013,CADASTRO DO BENEFICI√ÅRIO COM PROBLEMAS
1014,BENEFICI√ÅRIO COM DATA DE EXCLUS√ÉO
1015,IDADE DO BENEFICI√ÅRIO ACIMA IDADE LIMITE
1016,BENEFICI√ÅRIO COM ATENDIMENTO SUSPENSO
1017,DATA VALIDADE DA CARTEIRA VENCIDA
1018,EMPRESA DO BENEFICI√ÅRIO SUSPENSA / EXCLU√çDA
1019,FAM√çLIA DO BENEFICI√ÅRIO COM ATENDIMENTO SUSPENSO
1020,VIA DE CART√ÉO DO BENEFICI√ÅRIO CANCELADA
1021,VIA DE CART√ÉO DO BENEFICI√ÅRIO N√ÉO LIBERADA
1022,VIA DE CART√ÉO DO BENEFICI√ÅRIO N√ÉO COMPAT√çVEL
1023,NOME DO TITULAR INV√ÅLIDO
1024,PLANO N√ÉO EXISTENTE
1025,BENEFICI√ÅRIO N√ÉO POSSUI COBERTURA PARA ASSIST√äNCIA ODONTOL√ìGICA
1101,QUANTIDADE DE GUIAS INFORMADAS NO PROTOCOLO DIFERENTE DAS CADASTRADAS
1102,PROTOCOLO √â DE RE-APRESENTA√á√ÉO
1103,PROTOCOLO N√ÉO √â DE REAPRESENTA√á√ÉO
1104,VALOR TOTAL DO PROTOCOLO DIFERENTE DO VALOR TOTAL DAS GUIAS
1201,ATENDIMENTO FORA DA VIG√äNCIA DO CONTRATO COM O CREDENCIADO
1202,N√öMERO DO CNES INV√ÅLIDO
1203,C√ìDIGO PRESTADOR INV√ÅLIDO
1204,ADMISS√ÉO ANTERIOR √Ä INCLUS√ÉO DO CREDENCIADO NA REDE
1205,ADMISS√ÉO AP√ìS O DESLIGAMENTO DO CREDENCIADO DA REDE
1206,CPF / CNPJ INV√ÅLIDO
1207,CREDENCIADO N√ÉO PERTENCE √Ä REDE CREDENCIADA
1208,SOLICITA√á√ÉO ANTERIOR √Ä INCLUS√ÉO DO CREDENCIADO
1209,SOLICITA√á√ÉO AP√ìS O DESLIGAMENTO DO CREDENCIADO
1210,SOLICITANTE CREDENCIADO N√ÉO CADASTRADO
1211,ASSINATURA / CARIMBO DO CREDENCIADO INEXISTENTE
1212,ATENDIMENTO / REFER√äNCIA FORA DA VIG√äNCIA DO CONTRATO DO PRESTADOR
1213,CBO (ESPECIALIDADE) INV√ÅLIDO
1214,CREDENCIADO N√ÉO HABILITADO A REALIZAR O PROCEDIMENTO
1215,CREDENCIADO FORA DA ABRANG√äNCIA GEOGR√ÅFICA DO PLANO
1216,ESPECIALIDADE N√ÉO CADASTRADA
1217,ESPECIALIDADE N√ÉO CADASTRADA PARA O PRESTADOR
1218,C√ìDIGO DE PRESTADOR INCOMPATIVEL COM PROCEDIMENTO / EXAME COBRADO
1301,TIPO GUIA INV√ÅLIDO
1302,C√ìDIGO TIPO GUIA PRINCIPAL E N√öMERO GUIAS INCOMPAT√çVEIS
1303,N√ÉO EXISTE O N√öMERO GUIA PRINCIPAL INFORMADO
1304,COBRAN√áA EM GUIA INDEVIDA
1305,ITEM PAGO EM OUTRA GUIA
1306,N√ÉO EXISTE N√öMERO GUIA PRINCIPAL E/OU C√ìDIGO GUIA PRINCIPAL
1307,N√öMERO DA GUIA INV√ÅLIDO
1308,GUIA J√Å APRESENTADA
1309,PROCEDIMENTO CONTRATADO N√ÉO EST√Å DE ACORDO COM O TIPO DE GUIA UTILIZADO
1310,SERVI√áO DO TIPO CIR√öRGICO E INVASIVO. EQUIPE M√âDICA N√ÉO INFORMADA NA GUIA
1311,PRESTADOR EXECUTANTE N√ÉO INFORMADO
1312,PRESTADOR CONTRATADO N√ÉO INFORMADO
1313,GUIA COM RASURA
1314,GUIA SEM ASSINATURA E/OU CARIMBO DO CREDENCIADO.
1315,GUIA SEM DATA DO ATO CIR√öRGICO.
1316,GUIA COM LOCAL DE ATENDIMENTO PREENCHIDO INCORRETAMENTE.
1317,GUIA SEM DATA DO ATENDIMENTO
1318,GUIA COM C√ìDIGO DE SERVI√áO PREENCHIDO INCORRETAMENTE.
1319,GUIA SEM ASSINATURA DO ASSISTIDO.
1320,IDENTIFICA√á√ÉO DO ASSISTIDO INCOMPLETA
1321,VALIDADE DA GUIA EXPIRADA
1322,COMPROVANTE PRESENCIAL OU GTO N√ÉO ENVIADO
1323,DATA PREENCHIDA INCORRETAMENTE
1401,ACOMODA√á√ÉO N√ÉO AUTORIZADA
1402,PROCEDIMENTO N√ÉO AUTORIZADO
1403,N√ÉO EXISTE INFORMA√á√ÉO SOBRE A SENHA DE AUTORIZA√á√ÉO DO PROCEDIMENTO
1404,N√ÉO EXISTE GUIA DE AUTORIZA√á√ÉO RELACIONADA
1405,DATA DE VALIDADE DA SENHA √â ANTERIOR A DATA DO ATENDIMENTO
1406,N√öMERO DA SENHA INFORMADO DIFERENTE DO LIBERADO
1407,SERVI√áO SOLICITADO N√ÉO POSSUI COBERTURA
1408,QUANTIDADE SERVI√áO SOLICITADA ACIMA DA AUTORIZADA
1409,QUANTIDADE SERVI√áO SOLICITADA ACIMA COBERTA
1410,SERVI√áO SOLICITADO EM CAR√äNCIA
1411,SOLICITANTE N√ÉO INFORMADO
1412,PROBLEMAS NO SISTEMA AUTORIZADOR
1413,ACOMODA√á√ÉO N√ÉO POSSUI COBERTURA
1414,DATA DE VALIDADE DA SENHA EXPIRADA
1415,PROCEDIMENTO N√ÉO AUTORIZADO PARA O BENEFICI√ÅRIO
1416,SOLICITANTE N√ÉO CADASTRADO
1417,SOLICITANTE N√ÉO HABILITADO
1418,SOLICITANTE SUSPENSO
1419,SERVI√áO SOLICITADO J√Å AUTORIZADO
1420,SERVI√áO SOLICITADO FORA DA COBERTURA
1421,SERVI√áO SOLICITADO √â DE PR√â-EXIST√äNCIA
1422,ESPECIALIDADE N√ÉO CADASTRADA PARA O SOLICITANTE
1423,QUANTIDADE SOLICITADA ACIMA DA QUANTIDADE PERMITIDA
1424,QUANTIDADE AUTORIZADA ACIMA DA QUANTIDADE PERMITIDA
1425,NECESSITA PR√â-AUTORIZA√á√ÉO DA EMPRESA
1426,N√ÉO AUTORIZADO PELA AUDITORIA
1427,NECESSIDADE DE AUDITORIA M√âDICA
1428,FALTA DE AUTORIZA√á√ÉO DA EMPRESA DE CONECTIVIDADE
1429,CBO-S (ESPECIALIDADE) N√ÉO AUTORIZADO A REALIZAR O SERVI√áO
1430,PROCEDIMENTO ODONTOL√ìGICO N√ÉO AUTORIZADO
1431,PROCEDIMENTO N√ÉO AUTORIZADO NA FACE SOLICITADA
1432,PROCEDIMENTO N√ÉO AUTORIZADO PARA DENTE/REGI√ÉO SOLICITADA
1433,"PROCEDIMENTO N√ÉO AUTORIZADO DENTE AUSENTE "
1434,COBRAN√áA DE CONTA DE CTI NEONATAL NA SENHA DO PARTO
1435,VIG√äNCIA DO ACORDO POSTERIOR √Ä DATA DE REALIZA√á√ÉO DO PROCEDIMENTO
1436,CANCELAMENTO DO ACORDO ANTERIOR √Ä DATA DE REALIZA√á√ÉO DO PROCEDIMENTO
1437,SENHA DE AUTORIZA√á√ÉO CANCELADA
1438,PROCEDIMENTO SOLICITADO N√ÉO AUTORIZADO POR N√ÉO ATENDER A DIRETRIZ DE UTILIZA√á√ÉO (DUT) DO ROL DE PROCEDIMENTOS E EVENTOS EM SA√öDE DA ANS
1501,TEMPO DE EVOLU√á√ÉO DA DOEN√áA INV√ÅLIDO
1502,TIPO DE DOEN√áA INV√ÅLIDO
1503,INDICADOR DE ACIDENTE INV√ÅLIDO
1504,CAR√ÅTER DE INTERNA√á√ÉO INV√ÅLIDO
1505,REGIME DA INTERNA√á√ÉO INV√ÅLIDO
1506,TIPO DE INTERNA√á√ÉO INV√ÅLIDO
1507,URG√äNCIA/EMERG√äNCIA N√ÉO APLIC√ÅVEL
1508,C√ìDIGO CID N√ÉO INFORMADO
1509,C√ìDIGO CID INV√ÅLIDO
1601,REINCID√äNCIA NO ATENDIMENTO
1602,TIPO DE ATENDIMENTO INV√ÅLIDO OU N√ÉO INFORMADO
1603,TIPO DE CONSULTA INV√ÅLIDO
1604,TIPO DE SA√çDA INV√ÅLIDO
1605,INTERVEN√á√ÉO ANTERIOR A ADMISS√ÉO
1606,FINAL DA INTERVEN√á√ÉO ANTERIOR AO IN√çCIO DA INTERVEN√á√ÉO
1607,ALTA HOSPITALAR ANTERIOR AO FINAL DA INTERVEN√á√ÉO
1608,ALTA ANTERIOR √Ä DATA DE INTERNA√á√ÉO
1609,MOTIVO SA√çDA INV√ÅLIDO
1610,√ìBITO MULHER INV√ÅLIDO
1611,INTERVEN√á√ÉO ANTERIOR A INTERNA√á√ÉO
1612,SERVI√áO N√ÉO PODE SER REALIZADO NO LOCAL ESPECIFICADO
1613,CONSULTA N√ÉO AUTORIZADA
1614,SERVI√áO AMBULATORIAL N√ÉO AUTORIZADO
1615,INTERNA√á√ÉO N√ÉO AUTORIZADA
1701,COBRAN√áA FORA DO PRAZO DE VALIDADE
1702,COBRAN√áA DE PROCEDIMENTO EM DUPLICIDADE
1703,HOR√ÅRIO DO ATENDIMENTO N√ÉO EST√Å NA FAIXA DE URG√äNCIA/EMERG√äNCIA
1704,VALOR COBRADO SUPERIOR AO ACORDADO EM PACOTE
1705,VALOR APRESENTADO A MAIOR
1706,VALOR APRESENTADO A MENOR
1707,N√ÉO EXISTE INFORMA√á√ÉO SOBRE A TABELA QUE SER√Å UTILIZADA NA VALORA√á√ÉO. VERIFIQUE O CONTRATO DO PRESTADOR
1708,N√ÉO EXISTE VALOR PARA O PROCEDIMENTO REALIZADO
1709,FALTA PRESCRI√á√ÉO M√âDICA
1710,FALTA VISTO DA ENFERMAGEM
1711,PROCEDIMENTO PERTENCE A UM PACOTE ACORDADO E J√Å COBRADO
1712,ASSINATURA DO M√âDICO RESPONS√ÅVEL PELO EXAME INEXISTENTE
1713,FATURAMENTO INV√ÅLIDO
1714,VALOR DO SERVI√áO SUPERIOR AO VALOR DE TABELA
1715,VALOR DO SERVI√áO INFERIOR AO VALOR DE TABELA
1716,PERCENTUAL DE REDU√á√ÉO/ACR√âSCIMO FORA DOS VALORES DEFINIDOS EM TABELA
1717,PAGO  CONFORME RELAT√ìRIO DE AUDITORIA EXTERNA - CONTA INICIAL
1718,"REAN√ÅLISE NEGADA PAGO CONFORME RELAT√ìRIO AUDITORIA"
1719,"REAN√ÅLISE NEGADA AN√ÅLISE CONFORME TABELA ACORDADA"
1720,"LIBERADOS 150% DE V√çDEO SEM COBERTURA PARA ADICIONAL DE ACOMODA√á√ÉO"
1721,C√ìDIGO COBRADO SUBSTITU√çDO PELO C√ìDIGO PAGO
1722,PAGO CONFORME NEGOCIA√á√ÉO
1723,ADICIONAL DE URG√äNCIA N√ÉO PREVISTO PARA ATENDIMENTO CL√çNICO
1724,VISITA M√âDICA COBRADA PELA EQUIPE CIR√öRGICA INCLU√çDA NO PER√çODO DE 10 DIAS AP√ìS REALIZA√á√ÉO DO PROCEDIMENTO CIR√öRGICO
1725,VALOR PAGO A MAIOR REFERENTE √Ä TAXA ADMINISTRATIVA
1726,VALOR APRESENTADO A MAIOR - PLANO INDIVIDUAL
1727,PAGO VALOR COMPATIVEL COM O PROCEDIMENTO
1728,COBRAN√áA DE MATERIAL INCLUSO NO PROCEDIMENTO / EXAME REALIZADO
1729,COBRAN√áA DE MATERIAL COM VALOR ACIMA DO PERMITIDO PARA PROCEDIMENTO/EXAME REALIZADO
1730,FILME INCLUSO NO EXAME REALIZADO
1731,TAXA INCOMPATIVEL PARA ATENDIMENTO AMBULATORIAL
1732,QT COM DATA DE EVENTO DIVERGENTE DA LIBERADA
1733,RECUPERA√á√ÉO DE VALORES POR PAGAMENTO INDEVIDO
1734,"COBRADO CONTA ABERTA PAGO O PACOTE CONFORME NEGOCIA√á√ÉO"
1735,COBRAN√áA DE PACOTE N√ÉO NEGOCIADO COM O PRESTADOR
1736,CONTA AGUARDANDO NEGOCIA√á√ÉO PARA PAGAMENTO
1737,DIFEREN√áA DEVE SER COBRADA DO BENEFICI√ÅRIO PELO PRESTADOR COMO FRANQUIA
1738,DOCUMENTO FISCAL N√ÉO ENVIADO
1739,DUPLICIDADE DE CONTA DEVIDO A PERIODO COBRADO J√Å EFETUADO EM OUTRA PARCIAL
1740,ESTORNO DO VALOR DE PROCEDIMENTO PAGO
1741,HONOR√ÅRIO OU PROCEDIMENTO J√Å PAGO A OUTRO PRESTADOR
1742,HONOR√ÅRIO OU PROCEDIMENTO J√Å PAGO POR REEMBOLSO AO BENEFICI√ÅRIO
1743,"N√ÉO H√Å NEGOCIA√á√ÉO PARA COBRAN√áA DO KIT DISCRIMINAR POR ITENS"
1744,NEGOCIA√á√ÉO DIFERENCIADA DEVIDO A LIMINAR
1745,PAGAMENTO DA EQUIPE CONFORME RELAT√ìRIO DO CIRURGI√ÉO
1746,PERCENTUAL DE ACR√âSCIMO DIFERENTE DO NEGOCIADO
1747,PLANO DO BENEFICI√ÅRIO E O TIPO DE ACOMODA√á√ÉO N√ÉO PERMITEM ACR√âSCIMO DE HONOR√ÅRIOS
1748,PROCEDIMENTO N√ÉO CARACTERIZA URG√äNCIA/EM√äRGENCIA
1749,RELAT√ìRIO DE AUDITORIA N√ÉO ENVIADO NA CONTA.
1801,PROCEDIMENTO INV√ÅLIDO
1802,PROCEDIMENTO INCOMPAT√çVEL COM O SEXO DO BENEFICI√ÅRIO
1803,IDADE DO BENEFICI√ÅRIO INCOMPAT√çVEL COM O PROCEDIMENTO
1804,N√öMERO DE DIAS LIBERADOS / SESS√ïES AUTORIZADAS N√ÉO INFORMADAS
1805,VALOR TOTAL DO PROCEDIMENTO DIFERENTE DO VALOR PROCESSADO
1806,QUANTIDADE DE PROCEDIMENTO DEVE SER MAIOR QUE ZERO
1807,PROCEDIMENTOS M√âDICOS DUPLICADOS
1808,PROCEDIMENTO N√ÉO CONFORME COM CID
1809,COBRAN√áA DE PROCEDIMENTO N√ÉO EXECUTADO
1810,COBRAN√áA DE PROCEDIMENTO N√ÉO SOLICITADO PELO M√âDICO
1811,PROCEDIMENTO SEM REGISTRO DE EXECU√á√ÉO
1812,COBRAN√áA DE PROCEDIMENTO N√ÉO CORRELACIONADO AO RELAT√ìRIO ESPEC√çFICO
1813,COBRAN√áA DE PROCEDIMENTO SEM JUSTIFICATIVA PARA REALIZA√á√ÉO OU COM JUSTIFICATIVA INSUFICIENTE.
1814,COBRAN√áA DE PROCEDIMENTO COM DATA DE AUTORIZA√á√ÉO POSTERIOR √Ä DO ATENDIMENTO.
1816,COBRAN√áA DE PROCEDIMENTO EM QUANTIDADE INCOMPAT√çVEL COM O PROCEDIMENTO/EVOLU√á√ÉO CL√çNICA
1817,COBRAN√áA DE PROCEDIMENTO INCLUSO NO PROCEDIMENTO PRINCIPAL
1818,COBRAN√áA DE PROCEDIMENTO QUE EXIGE AUTORIZA√á√ÉO PR√âVIA
1819,COBRAN√áA DE PROCEDIMENTO COM HIST√ìRIA CL√çNICA/HIP√ìTESE DIAGN√ìSTICA N√ÉO COMPAT√çVEL
1820,COBRAN√áA DE PROCEDIMENTO EM QUANTIDADE ACIMA DA M√ÅXIMA PERMITIDA/AUTORIZADA
1821,COBRAN√áA DE PROCEDIMENTO N√ÉO COMPAT√çVEL COM A IDADE.
1822,COBRAN√áA DE PROCEDIMENTO COM AUS√äNCIA DE RESULTADO OU LAUDO T√âCNICO.
1823,PROCEDIMENTO REALIZADO PELO MESMO PROFISSIONAL NA MESMA ESPECIALIDADE NO PRAZO INFERIOR AO ESTIPULADO SEM JUSTIFICATIVA ADEQUADA.
1824,PROCEDIMENTO COBRADO N√ÉO CORRESPONDE AO EXAME EXECUTADO
1825,COBRAN√áA DE PROCEDIMENTO AMBULATORIAL COM DATA DE AUTORIZA√á√ÉO POSTERIOR √Ä DO ATENDIMENTO.
1826,VIAS DE ACESSO DOS PROCEDIMENTOS COBRADOS N√ÉO EST√ÉO PREVISTAS NA LISTAGEM DE PROCEDIMENTOS M√öLTIPLOS.
1827,COBRAN√áA DE OUTRO PROCEDIMENTO EM OUTRA GUIA NA MESMA DATA PELO MESMO PROFISSIONAL COM MESMO GRAU DE PARTICIPA√á√ÉO - LIBERADO VALOR REFERENTE √Ä VIA DE ACESSO DO PROCEDIMENTO SECUND√ÅRIO.
1828,ADICIONAL DE URG√äNCIA N√ÉO PREVISTO PARA PROCEDIMENTO CIR√öRGICO ELETIVO.
1829,ADICIONAL DE V√çDEO N√ÉO PREVISTO PARA O PROCEDIMENTO.
1830,"COBRAN√áA DE PROCEDIMENTO SEM INFORMA√á√ÉO DAS DATAS DE ATENDIMENTO-VISITA PLANT√ÉO INTENSIVISTA AVALIA√á√ÉO ENTERAL/PARENTERAL"
1831,LAUDO DO EXAME ENVIADO N√ÉO JUSTIFICA A COBRAN√áA DO PROCEDIMENTO
1832,PROCEDIMENTO N√ÉO PERMITE COBRAN√áA DE AUXILIAR DE ANESTESISTA
1833,PROCEDIMENTO COBRADO N√ÉO PERMITE ACR√âSCIMO DE ACOMODA√á√ÉO
1834,PORTE ANEST√âSICO COBRADO INCOMPAT√çVEL COM O PORTE DO PROCEDIMENTO REALIZADO
1835,ANALGESIA POR DIA SUBSEQUENTE N√ÉO JUSTIFICADA EM RELAT√ìRIO M√âDICO PARA O PROCEDIMENTO REALIZADO E/OU DATA DO ATENDIMENTO
1836,ANALGESIA POR DIA SUBSEQUENTE INCOMPAT√çVEL COM A VIA DE ADMINISTRA√á√ÉO DO MEDICAMENTO - VO OU IV PERIF√âRICA - SENDO LIBERADA VISITA HOSPITALAR
1837,N√ÉO CABE PAGAMENTO DO HONOR√ÅRIO INTEGRAL POR SER VIA DE ACESSO CIR√öRGICO DIFERENTE
1838,GRAU DE PARTICIPA√á√ÉO INFORMADO INCOMPAT√çVEL COM EVENTO COBRADO.
1839,NECESS√ÅRIO ENVIO DO RESULTADO DO EXAME AN√ÅTOMO PATOL√ìGICO
1840,PROCEDIMENTO EXECUTADO ANTES DA AUTORIZA√á√ÉO
1901,ACOMODA√á√ÉO INV√ÅLIDA
1902,ACOMODA√á√ÉO INFORMADA N√ÉO EST√Å DE ACORDO COM ACOMODA√á√ÉO CONTRATADA
1903,PERMAN√äNCIA HOSPITALAR INCOMPAT√çVEL COM A EVOLU√á√ÉO CL√çNICA
1904,PERMAN√äNCIA HOSPITALAR INCOMPAT√çVEL COM O PROCEDIMENTO AUTORIZADO
1905,QUANTIDADE DE DI√ÅRIAS DEVE SER MAIOR QUE ZERO
1906,ACOMODA√á√ÉO N√ÉO INFORMADA
1907,QUANTIDADE UTI N√ÉO PREVISTA PARA PROCEDIMENTO
1908,USU√ÅRIO N√ÉO POSSUI COBERTURA DE UTI
1910,"COBRAN√áA DE DI√ÅRIAS EM LOCAIS DE ACOMODA√á√ïES DIFERENTES NO MESMO DIA."
1911,PERMAN√äNCIA HOSPITALAR PARA INVESTIGA√á√ÉO INJUSTIFICADA.
1912,EVOLU√á√ÉO CL√çNICA N√ÉO COMPAT√çVEL COM A PERMAN√äNCIA EM UTI.
1913,C√ìDIGO DE DI√ÅRIA INCOMPAT√çVEL COM O LOCAL DE ATENDIMENTO.
1914,COBRAN√áA DE DI√ÅRIA EM QUANTIDADE INCOMPAT√çVEL COM A PERMAN√äNCIA HOSPITALAR.
1915,"MUDAN√áA DE ACOMODA√á√ÉO SEM COMUNICA√á√ÉO AO PACIENTE FAMILIAR OU ACOMPANHANTE OU SEM SOLICITA√á√ÉO DESTES."
1916,COBRAN√áA DE DI√ÅRIAS DE UTI INCOMPAT√çVEL COM DIAGN√ìSTICO E EVOLU√á√ÉO CL√çNICA.
1917,FALTA PRORROGA√á√ÉO PARA QUANTIDADE DE DI√ÅRIAS COBRADAS.
1918,PLANO DO BENEFICI√ÅRIO N√ÉO CONTEMPLA DI√ÅRIA DE ACOMPANHANTE
2001,MATERIAL INV√ÅLIDO
2002,MATERIAL SEM COBERTURA PARA ATENDIMENTO AMBULATORIAL
2003,MATERIAL N√ÉO ESPECIFICADO
2004,MATERIAL SEM NOTA FISCAL DO FORNECEDOR
2005,QUANTIDADE DE MATERIAL DEVE SER MAIOR QUE ZERO
2006,MATERIAL INFORMADO N√ÉO COBERTO
2007,COBRAN√áA DE MATERIAL EM QUANTIDADE INCOMPAT√çVEL COM A PERMAN√äNCIA.
2008,COBRAN√áA DE MATERIAL EM QUANTIDADES INCOMPAT√çVEIS COM O PROCEDIMENTO REALIZADO.
2009,QUANTIDADE DE MATERIAL SUPERIOR A QUANTIDADE COBERTA
2010,COBRAN√áA DE MATERIAIS INCLUSOS NAS TAXAS
2011,COBRAN√áA DE MATERIAL INCLUSO NO PACOTE NEGOCIADO.
2012,COBRAN√áA DE MATERIAL INCOMPAT√çVEL COM O RELAT√ìRIO T√âCNICO.
2013,COBRAN√áA DE MATERIAL EM PERMAN√äNCIA HOSPITALAR N√ÉO AUTORIZADA.
2014,COBRAN√áA DE MATERIAL N√ÉO UTILIZADO
2015,MATERIAL N√ÉO AUTORIZADO
2101,MEDICAMENTO INV√ÅLIDO
2102,MEDICAMENTO SEM COBERTURA PARA ATENDIMENTO AMBULATORIAL
2103,MEDICAMENTO N√ÉO ESPECIFICADO
2104,MEDICAMENTO SEM NOTA FISCAL DO FORNECEDOR
2105,QUANTIDADE DE MEDICAMENTOS DEVE SER MAIOR QUE ZERO
2106,MEDICAMENTO INFORMADO N√ÉO COBERTO
2107,COBRAN√áA DE MEDICAMENTO EM QUANTIDADE INCOMPAT√çVEL COM A PERMAN√äNCIA.
2108,COBRAN√áA DE MEDICAMENTO EM QUANTIDADES INCOMPAT√çVEIS COM O PROCEDIMENTO REALIZADO.
2109,QUANTIDADE DE MEDICAMENTO SUPERIOR A QUANTIDADE COBERTA
2110,COBRAN√áA DE MEDICAMENTO INCLUSOS NAS TAXAS
2111,COBRAN√áA DE MEDICAMENTO INCLUSO NO PACOTE NEGOCIADO.
2112,COBRAN√áA DE MEDICAMENTO INCOMPAT√çVEL COM O RELAT√ìRIO T√âCNICO.
2113,COBRAN√áA DE MEDICAMENTO EM PERMAN√äNCIA HOSPITALAR N√ÉO AUTORIZADA.
2114,COBRAN√áA DE MEDICAMENTO N√ÉO UTILIZADO
2115,MEDICAMENTO N√ÉO AUTORIZADO
2201,OPME INV√ÅLIDO
2202,OPME SEM COBERTURA PARA ATENDIMENTO AMBULATORIAL
2203,OPME SEM NOTA FISCAL DO FORNECEDOR
2204,QUANTIDADE DE OPME DEVE SER MAIOR QUE ZERO
2205,OPME INFORMADO N√ÉO COBERTO
2206,OPME INFORMADO N√ÉO AUTORIZADO
2207,COBRAN√áA DE OPME N√ÉO UTILIZADO
2208,COBRAN√áA DE OPME NO ITEM MATERIAL E MEDICAMENTOS.
2209,COBRAN√áA DE OPME EM DESACORDO COM RELAT√ìRIO T√âCNICO
2210,COBRAN√áA DE OPME EM QUANTIDADE INCOMPAT√çVEL COM O PROCEDIMENTO REALIZADO
2211,COBRAN√áA DE OPME INCLUSA NO PACOTE NEGOCIADO
2212,OPME EM DESACORDO COM OS CRIT√âRIOS T√âCNICOS ADOTADOS PELA OPERADORA
2213,OPME PAGO A FORNECEDOR TERCEIRIZADO
2301,GASES MEDICINAIS INV√ÅLIDOS
2302,COBRAN√áA DE OXIGENOTERAPIA SEM PRESCRI√á√ÉO M√âDICA.
2303,COBRAN√áA DE OXIGENOTERAPIA COM QUANTITATIVO DE USO EM DIVERG√äNCIA/PAGO VALOR CORRIGIDO.
2304,COBRAN√áA DE OXIG√äNIO INCLUSO NA TAXA DE NEBULIZA√á√ÉO ESPECIFICADA.
2305,COBRAN√áA DE OXIGENOTERAPIA EM USO PROLONGADO  SEM  JUSTIFICATIVA DE USO.
2306,COBRAN√áA DE OXIGENOTERAPIA SEM REGISTRO DE CONTROLE DE USO (ENTRADA E SA√çDA).
2307,COBRAN√áA DE GASES EM QUANTIDADE SUPERIOR AO PER√çODO DE PERMAN√äNCIA
2308,COBRAN√áA DE CO2 NAS CIRURGIAS VIDEOLAPAROSC√ìPICAS DURANTE TODA A REALIZA√á√ÉO DO PROCEDIMENTO (IN√çCIO AO FIM).
2309,COBRAN√áA DE AR COMPRIMIDO SEM REGISTRO NO BOLETIM ANEST√âSICO E DURA√á√ÉO DE USO.
2310,COBRAN√áA DE GASES INCOMPAT√çVEL COM O UTILIZADO/ PRESCRITO.
2401,TAXA / ALUGUEL INV√ÅLIDO
2402,COBRAN√áA DE TAXA POR USO DE EQUIPAMENTO INCOMPAT√çVEL COM O PROCEDIMENTO REALIZADO/USO PREVISTO NO PROCEDIMENTO.
2403,COBRAN√áA DE TAXA DE USO DE BOMBA DE INFUS√ÉO EM PACIENTE INTERNADO NA UTI
2404,COBRAN√áA DE OUTRAS TAXAS ASSOCIADAS/INCLUSAS NA COBRAN√áA DA TAXA DE SALA PREVISTA.
2405,"COBRAN√áA DE MAIS DE UMA TAXA DE SALA DE CIRURGIA POR CONTA DO N√öMERO DE PROCEDIMENTOS REALIZADOS NO MESMO TEMPO CIR√öRGICO."
2406,COBRAN√áA INDEVIDA DE TAXA DE SALA POR ADMINISTRA√á√ÉO DE MEDICAMENTOS.
2407,"COBRAN√áA DE TAXAS DE SERVI√áOS REALIZADOS EM AMBIENTES INCOMPAT√çVEIS COM O USO DE EQUIPAMENTOS."
2408,COBRAN√áA DE TAXAS EM QUANTIDADE SUPERIOR AO TEMPO DE PERMAN√äNCIA HOSPITALAR
2409,COBRAN√áA DE TAXA DE OBSERVA√á√ÉO EM PRONTO SOCORRO COM PERMAN√äNCIA MENOR QUE O PER√çODO ESTIPULADO
2410,COBRAN√áA DE TAXA DE OBSERVA√á√ÉO EM PRONTO SOCORRO SEM O REGISTRO DA PERMAN√äNCIA.
2411,"COBRAN√áA DE TAXA DE SALA DE PRONTO SOCORRO PARA APLICA√á√ÉO DE MEDICAMENTOS."
2412,COBRAN√áA DE TAXA DE RECUPERA√á√ÉO ANEST√âSICA N√ÉO JUSTIFICADA PARA O PROCEDIMENTO.
2413,COBRAN√áA DE TAXA INCLUSA NO PACOTE NEGOCIADO.
2414,COBRAN√áA DE TAXA DE EQUIPAMENTO EM CONCOMIT√ÇNCIA COM A COBRAN√áA DE TAXA PARA O PROCEDIMENTO.
2415,TAXA EXIGE INFORMA√á√ÉO DO VALOR NA GUIA.
2416,COBRAN√áA DE TAXA DE RECUPERA√á√ÉO ANEST√âSICA PARA PACIENTES COM P√ìS-OPERAT√ìRIO IMEDIATO REALIZADO NA UTI/CTI.
2417,COBRAN√áA DE TAXA DE RECUPERA√á√ÉO ANEST√âSICA SEM A PRESEN√áA DO ANESTESISTA.
2418,COBRAN√áA DE TAXA DE SALA INCOMPAT√çVEL COM O PROCEDIMENTO.
2419,COBRAN√áA DE TAXA DE OBSERVA√á√ÉO PARA ATENDIMENTO QUE GEROU UMA INTERNA√á√ÉO.
2420,COBRAN√áA DE TAXA DE SALA CIR√öRGICA COM PORTE ANEST√âSICO DIFERENTE DO PROCEDIMENTO AUTORIZADO/REALIZADO.
2421,COBRAN√áA DE TAXA EM QUANTIDADE INCORRETA.
2422,"COBRAN√áA DE TAXA POR USO DE EQUIPAMENTO DE USO OBRIGAT√ìRIO NA SALA DE CIRURGIA CUJA TAXA DE SALA CIR√öRGICA J√Å INCLUI SEU USO."
2423,COBRAN√áA DE TAXA DE EQUIPAMENTOS DE USO OBRIGAT√ìRIO NO LOCAL DE ATENDIMENTO.
2501,PROCEDIMENTO EM S√âRIE INV√ÅLIDO
2502,COBRAN√áA DE DUAS AVALIA√á√ïES FISIOTER√ÅPICAS
2503,"COBRAN√áA DE PSICOTERAPIA INDIVIDUAL QUANDO O APLICADO √â A COBRAN√áA DE PSICOTERAPIA EM GRUPO"
2504,QUANTIDADE DE SESS√ïES COBRADAS N√ÉO CONDIZEM COM AS ASSINATURAS NO CONTROLE DE TRATAMENTO SERIADO
2505,O C√ìDIGO COBRADO √â DIFERENTE DO C√ìDIGO AUTORIZADO
2506,A QUANTIDADE DE SESS√ïES COBRADAS √â DIFERENTE DA QUANTIDADE AUTORIZADA
2507,O C√ìDIGO AUTORIZADO EST√Å INCOMPAT√çVEL COM A PRESCRI√á√ÉO M√âDICA SOLICITADA
2508,"COBRAN√áA DE SESS√ïES SEM O DEVIDO PLANO DE TRATAMENTO E OU COM O PRAZO DE PAGAMENTO EXPIRADO"
2509,COBRAN√áA DO PROCEDIMENTO SERIADO INCOMPAT√çVEL COM O QUADRO CL√çNICO
2510,COBRAN√áA DO PROCEDIMENTO SERIADO EM N√öMERO DE SESS√ïES ACIMA DA QUANTIDADE ESTABELECIDA
2511,AUS√äNCIA DE EVOLU√á√ÉO NO PRONTU√ÅRIO M√âDICO DO TRATAMENTO SERIADO REALIZADO.
2512,COBRAN√áA DE SESS√ïES DE FISIOTERAPIA EM DESACORDO COM AS EVOLU√á√ïES DO PRONTU√ÅRIO M√âDICO
2513,COBRAN√áA DE TRATAMENTO SERIADO SEM JUSTIFICATIVA CL√çNICA/T√âCNICA
2514,SERVI√áO N√ÉO CONTRATADO PARA O PRESTADOR
2515,LOCAL DE ATENDIMENTO INADEQUADO
2516,QUANTIDADE COBRADA DIFERENTE DA REALIZADA
2601,CODIFICA√á√ÉO INCORRETA/INADEQUADA DO PROCEDIMENTO.
2602,COBRAN√áA DE HONOR√ÅRIO INCLUSO NO PROCEDIMENTO PRINCIPAL
2603,COBRAN√áA DE HONOR√ÅRIO SEM REGISTRO DA EFETIVA PARTICIPA√á√ÉO DO PROFISSIONAL
2604,PROCEDIMENTO PRINCIPAL N√ÉO REQUER EQUIPE M√âDICA
2605,N√ÉO CABE PAGAMENTO DO HONOR√ÅRIO INTEGRAL POR SER A MESMA VIA DE ACESSO CIR√öRGICO.
2606,COBRAN√áA DO HONOR√ÅRIO EM LOCAL DE ATENDIMENTO INCORRETO (INEXISTENTE).
2607,COBRAN√áA DE HONOR√ÅRIOS EM DUPLICIDADE.
2608,"COBRAN√áA DE CONSULTA INDEVIDA QUANDO O PROCEDIMENTO PRINCIPAL J√Å EST√Å SENDO REMUNERADO."
2609,LOCAL DE ATENDIMENTO N√ÉO INFORMADO.
2610,GRAU DE PARTICIPA√á√ÉO DE AUXILIAR INCOMPAT√çVEL COM PROCEDIMENTO COBRADO
2611,COBRAN√áA DE ESPECIALISTA N√ÉO JUSTIFICADA NO EVENTO
2612,"COBRAN√áA INDEVIDA DE EQUIPE ""STAND-BY"" J√Å QUE ANGIOPLASTIA SEGUIDA DE CIRURGIA CARD√çACA"
2613,"HONOR√ÅRIO M√âDICO DO ANESTESISTA J√Å LIBERADO NO PROCEDIMENTO CIR√öRGICO POIS ""ANALGESIA POR DIA SUBSEQUENTE"" COBRADA NA MESMA DATA DO EVENTO CIR√öRGICO"
2614,COBRAN√áA DE CADA PARTICIPANTE DA EQUIPE DEVE SER FEITA EM GUIAS DIFERENTES
2702,COBRAN√áA DE EXAME N√ÉO SOLICITADO PELO M√âDICO
2703,EXAME SEM REGISTRO DE EXECU√á√ÉO
2704,COBRAN√áA DE EXAME N√ÉO CORRELACIONADO AO RELAT√ìRIO ESPEC√çFICO
2705,COBRAN√áA DE PROCEDIMENTO/EXAME SEM JUSTIFICATIVA PARA REALIZA√á√ÉO OU COM JUSTIFICATIVA INSUFICIENTE.
2706,COBRAN√áA DE PROCEDIMENTO/EXAME COM DATA DE AUTORIZA√á√ÉO POSTERIOR √Ä DO ATENDIMENTO.
2707,EXAME N√ÉO AUTORIZADO
2708,COBRAN√áA DE EXAME EM QUANTIDADE INCOMPAT√çVEL COM O PROCEDIMENTO/EVOLU√á√ÉO CL√çNICA
2710,COBRAN√áA DE EXAME QUE EXIGE AUTORIZA√á√ÉO PR√âVIA
2711,COBRAN√áA DE EXAME COM HIST√ìRIA CL√çNICA/HIP√ìTESE DIAGN√ìSTICA N√ÉO COMPAT√çVEL
2712,COBRAN√áA DE EXAME EM QUANTIDADE ACIMA DA M√ÅXIMA PERMITIDA/AUTORIZADA
2713,COBRAN√áA DE EXAME N√ÉO COMPAT√çVEL COM A IDADE.
2714,COBRAN√áA DE EXAME COM AUS√äNCIA DE RESULTADO OU LAUDO T√âCNICO.
2715,"EXAME REALIZADO PELO MESMO PROFISSIONAL NA MESMA ESPECIALIDADE NO PRAZO INFERIOR AO ESTIPULADO SEM JUSTIFICATIVA ADEQUADA."
2716,EXAME COBRADO N√ÉO CORRESPONDE AO EXAME EXECUTADO
2717,COBRAN√áA DE EXAME AMBULATORIAL COM DATA DE AUTORIZA√á√ÉO POSTERIOR √Ä DO ATENDIMENTO.
2718,EXAMES N√ÉO JUSTIFICAM CAR√ÅTER DE URG√äNCIA
2801,PACOTE INV√ÅLIDO
2802,PACOTE INCOMPAT√çVEL COM O SEXO DO BENEFICI√ÅRIO
2803,IDADE DO BENEFICI√ÅRIO INCOMPAT√çVEL COM O PACOTE
2804,VALOR TOTAL DO PACOTE DIFERENTE DO VALOR PROCESSADO
2805,VALOR DO PACOTE SUPERIOR AO VALOR DOS ITENS
2806,COBRAN√áA DE PACOTE N√ÉO EXECUTADO
2807,COBRAN√áA DE PACOTE N√ÉO SOLICITADO PELO M√âDICO
2808,PACOTE SEM REGISTRO DE EXECU√á√ÉO
2809,COBRAN√áA DE PACOTE N√ÉO CORRELACIONADO AO RELAT√ìRIO ESPEC√çFICO
2810,COBRAN√áA DE PACOTE SEM JUSTIFICATIVA PARA REALIZA√á√ÉO OU COM JUSTIFICATIVA INSUFICIENTE.
2811,COBRAN√áA DE PACOTE COM DATA DE AUTORIZA√á√ÉO POSTERIOR √Ä DO ATENDIMENTO.
2812,PACOTE N√ÉO AUTORIZADO
2813,COBRAN√áA DE PACOTE EM QUANTIDADE INCOMPAT√çVEL COM O PROCEDIMENTO/EVOLU√á√ÉO CL√çNICA
2814,ITENS DE COMPOSI√á√ÉO DO PACOTE N√ÉO REALIZADOS
2815,COBRAN√áA DO PACOTE EXIGE AUTORIZA√á√ÉO PR√âVIA
2816,COBRAN√áA DE PACOTE COM HIST√ìRIA CL√çNICA/HIP√ìTESE DIAGN√ìSTICA N√ÉO COMPAT√çVEL
2817,COBRAN√áA DE PACOTE EM QUANTIDADE ACIMA DA M√ÅXIMA PERMITIDA/AUTORIZADA
2818,COBRAN√áA DE PACOTE N√ÉO COMPAT√çVEL COM A IDADE.
2819,COBRAN√áA DE PACOTE COM AUS√äNCIA DE RESULTADO OU LAUDO T√âCNICO.
2820,"PACOTE REALIZADO PELO MESMO PROFISSIONAL NA MESMA ESPECIALIDADE NO PRAZO INFERIOR AO ESTIPULADO SEM JUSTIFICATIVA ADEQUADA."
2821,PACOTE COBRADO N√ÉO CORRESPONDE AO EXAME EXECUTADO
2822,COBRAN√áA DE PACOTE AMBULATORIAL COM DATA DE AUTORIZA√á√ÉO POSTERIOR √Ä DO ATENDIMENTO.
2901,REVIS√ÉO DE GLOSA INV√ÅLIDA
2902,GLOSA MANTIDA
2903,PEDIDO DE REVIS√ÉO SEM JUSTIFICATIVA
2904,MAIS DE UM RECURSO DE GLOSA PARA A MESMA GUIA/PROTOCOLO
2905,A GUIA N√ÉO √â DE REVIS√ÉO
2907,PRAZO DE 180 DIAS ULTRAPASSADO PARA SOLICITA√á√ÉO DE REAN√ÅLISE
2908,SOLICITA√á√ÉO DE REAN√ÅLISE EFETUADA DE FORMA INCORRETA
2909,PRAZO PARA SOLICITA√á√ÉO DE RECURSO DE GLOSA PRESCRITO
3001,PROCEDIMENTO ODONTOL√ìGICO INV√ÅLIDO
3002,COBRAN√áA DE PROCEDIMENTO ODONTOL√ìGICO QUE EXIGE AUTORIZA√á√ÉO PR√âVIA
3003,IDADE DO BENEFICI√ÅRIO INCOMPAT√çVEL COM O PROCEDIMENTO ODONTOL√ìGICO
3004,COBRAN√áA DE PROCEDIMENTO ODONTOL√ìGICO EM QUANTIDADE ACIMA DA M√ÅXIMA PERMITIDA/AUTORIZADA
3007,PROCEDIMENTOS ODONTOL√ìGICOS DUPLICADOS
3008,PROCEDIMENTO ODONTOL√ìGICO INCLUSO NO PROCEDIMENTO PRINCIPAL
3009,COBRAN√áA DE PROCEDIMENTO ODONTOL√ìGICO N√ÉO EXECUTADO
3010,COBRAN√áA DE PROCEDIMENTO N√ÉO SOLICITADO PELO CIRURGI√ÉO-DENTISTA
3011,PROCEDIMENTO ODONTOL√ìGICO SEM REGISTRO DE EXECU√á√ÉO
3012,COBRAN√áA DE PROCEDIMENTO ODONTOL√ìGICO N√ÉO CORRELACIONADO AO RELAT√ìRIO ESPEC√çFICO
3013,COBRAN√áA DE PROCEDIMENTO ODONTOL√ìGICO SEM JUSTIFICATIVA PARA REALIZA√á√ÉO OU COM JUSTIFICATIVA INSUFICIENTE.
3014,COBRAN√áA DE PROCEDIMENTO ODONTOL√ìGICO COM DATA DE AUTORIZA√á√ÉO POSTERIOR √Ä DO ATENDIMENTO.
3015,COBRAN√áA DE PROCEDIMENTO ODONTOL√ìGICO COM AUS√äNCIA DE RESULTADO OU LAUDO T√âCNICO.
3016,"PROCEDIMENTO ODONTOL√ìGICO REALIZADO NA MESMA ESPECIALIDADE NO PRAZO INFERIOR AO ESTIPULADO SEM JUSTIFICATIVA"
3017,PROCEDIMENTO COBRADO N√ÉO CORRESPONDE A PER√çCIA (ESPECIFICAR).
3018,EVENTO GLOSADO POR AUDITORIA (ESPECIFICAR)
3019,"EVENTO SOB AN√ÅLISE T√âCNICA AGUARDANDO LIBERA√á√ÉO DE CONFIRMA√á√ÉO PARA POSTERIOR PAGAMENTO"
3020,"CONFORME DOCUMENTA√á√ÉO RADIOGR√ÅFICA ENVIADA EVENTO REALIZADO INADEQUADAMENTE"
3021,FALHA EM INFORMA√á√ÉO DE DADOS DE ARCADAS/HEMI-ARCOS
3022,FALHA EM INFORMA√á√ÉO DE DADOS DE DENTE INICIAL E/OU FINAL
3023,FALHA EM INFORMA√á√ÉO DE DADOS DE FACES DOS DENTES
3024,EVENTO S√ì POSS√çVEL EM DENTES DEC√çDUOS
3025,EVENTO S√ì POSS√çVEL EM DENTES PERMANENTES
3026,ERRO NAS INFORMA√á√ïES DE ORDEM DOS DENTES INICIAL E FINAL
3027,DESACORDO ENTRE O TIPO DE DENTE E O N√öMERO DE CANAIS SOLICITADOS
3028,EVENTO RESTRITO √Ä ESPECIALISTAS
3029,EVENTO N√ÉO INDICADO PELA AUDITORIA INICIAL
3030,AUDITORIA FINAL CONSTA QUE A RESTAURA√á√ÉO FOI REALIZADA EM OUTRO MATERIAL
3031,RADIOGRAFIA FORA DOS PADR√ïES T√âCNICOS
3032,INTERVALO DA √öLTIMA MPP INFERIOR A TR√äS MESES
3033,INTERVALO DA √öLTIMA MPP INFERIOR A QUATRO MESES
3034,JUSTIFICATIVA TECNICAMENTE N√ÉO SATISFAT√ìRIA
3035,PACIENTE EM TRATAMENTO COM O MESMO PROFISSIONAL
3036,PACIENTE EM TRATAMENTO COM OUTRO PROFISSIONAL
3037,PROCEDIMENTO COBRADO N√ÉO √â IGUAL AO EXECUTADO
3038,RADIOGRAFIA INICIAL INCONGRUENTE COM A RADIOGRAFIA FINAL
3039,RADIOGRAFIA N√ÉO CORRESPONDE AO PROCEDIMENTO COBRADO
3040,GLOSA T√âCNICA (ESPECIFICAR DETALHADAMENTE)
3041,AGUARDANDO DOCUMENTA√á√ÉO DE ORTODONTIA
3042,AP√ìS AN√ÅLISE DA RADIOGRAFIA INICIAL VERIFICOU-SE EXODONTIA DE INCLUSO
3043,AP√ìS AN√ÅLISE DA RADIOGRAFIA INICIAL VERIFICOU-SE EXODONTIA DE SEMI-INCLUSO
3044,AP√ìS AN√ÅLISE DA RADIOGRAFIA INICIAL VERIFICOU-SE EXODONTIA SIMPLES
3045,"AP√ìS AN√ÅLISE DA RADIOGRAFIA INICIAL VERIFICOU-SE EXODONTIA DE FRAGMENTO RADICULAR"
3046,AUDITORIA FINAL CONSTA QUE O PROCEDIMENTO FOI REALIZADO COM OUTRO MATERIAL
3047,AUS√äNCIA DE IMAGEM/FOTO/RADIOGRAFIA/ DIAGN√ìSTICO P√ìS PROCEDIMENTO ODONTOL√ìGICO
3048,CANCELAMENTO DO PROCEDIMENTO ODONTOL√ìGICO POR SOLICITA√á√ÉO DO BENEFICI√ÅRIO.
3049,CANCELAMENTO DO PROCEDIMENTO ODONTOL√ìGICO POR SOLICITA√á√ÉO DO PRESTADOR.
3050,COBRAN√áA DE URG√äNCIA/EMERG√äNCIA NA VIG√äNCIA DO TRATAMENTO ODONTOL√ìGICO.
3051,DOCUMENTA√á√ÉO EM AN√ÅLISE
3052,"DOCUMENTA√á√ÉO INCOMPLETA INCORRETA OU AUSENTE"
3053,ELEMENTOS PODEM SER VISUALIZADOS EM UMA MESMA PEL√çCULA.
3054,IDENTIFICADO CONDUTO(S) N√ÉO OBTURADO(S)
3055,IDENTIFICADO TRATAMENTO ENDOD√îNTICO E N√ÉO RETRATAMENTO
3056,NA AUDITORIA FOI CONSTATADA DIVERG√äNCIA NA QUANTIDADE DE FACES RESTAURADAS
3057,N√ÉO APRESENTA A QUANTIDADE M√çNIMA DE ELEMENTOS DENT√ÅRIOS POR SEGMENTO
3058,NECESS√ÅRIA AUDITORIA FINAL
3059,NECESS√ÅRIA AUDITORIA INICIAL
3060,NECESS√ÅRIA AUDITORIA INTERMEDI√ÅRIA
3061,NECESS√ÅRIA AVALIA√á√ÉO DO ESPECIALISTA
3062,NECESS√ÅRIO ENVIAR LAUDO OU RELAT√ìRIO T√âCNICO SOBRE O TRATAMENTO SOLICITADO.
3063,O PLANO DE TRATAMENTO AUTORIZADO SER√Å CANCELADO DEVIDO √Ä TROCA DE PROFISSIONAL
3064,PROCEDIMENTO AUTORIZADO APENAS PARA DENTES TRATADOS ENDODONTICAMENTE
3065,PROCEDIMENTO AUTORIZADO SOMENTE PARA DENTES ANTERIORES
3066,PROCEDIMENTO EM DESACORDO COM O ANEXO GUIA TRATAMENTO ODONTOL√ìGICO SITUA√á√ÉO INICIAL
3067,RADIOGRAFIA FINAL N√ÉO ENVIADA
3068,RADIOGRAFIA FINAL SEM DISSOCIA√á√ÉO DOS CONDUTOS
3069,RADIOGRAFIA INDICA A NECESSIDADE DE TRATAMENTO ENDODONTICO
3070,RADIOGRAFIA INDICA A PRESEN√áA DE RAIZ RESIDUAL NO ALVEOLO
3071,RADIOGRAFIA INDICA AUSENCIA DE N√öCLEO
3072,RADIOGRAFIA INDICA CANAL(AIS) N√ÉO OBTURADO(S)
3073,RADIOGRAFIA INDICA DESVIO DA TRAJETORIA DO CANAL
3074,RADIOGRAFIA INDICA EXCESSO DE MATERIAL
3075,RADIOGRAFIA INDICA FALHA NA OBTURA√á√ÉO DO(S) CONDUTO(S)
3076,RADIOGRAFIA INDICA FALTA DE ADAPTA√á√ÉO DA COROA/N√öCLEO
3077,RADIOGRAFIA INDICA FALTA DE ADAPTA√á√ÉO DA COROA/PE√áA PROT√âTICA
3078,RADIOGRAFIA INDICA N√öCLEO INADEQUADO
3079,RADIOGRAFIA INDICA TRATAMENTO ENDOD√îNTICO E N√ÉO RETRATATAMENTO  ENDOD√îNTICO
3080,RADIOGRAFIA INICIAL E FINAL N√ÉO ENVIADAS
3081,RADIOGRAFIA INICIAL N√ÉO ENVIADA
3082,RADIOGRAFIA/IMAGEM INDICA FALHA NA RESTAURA√á√ÉO
3083,"REAVALIAR O PLANO DE TRATAMENTO OBSERVANDO CRIT√âRIOS DE INDICA√á√ÉO OPORTUNIDADE E VIABILIDADE."
3084,RELAT√ìRIO ANALISE T√âCNICA SEM CARIMBO/ASSINATURA DO  PRESTADOR
3085,RADIOGRAFIA N√ÉO CORRESPONDE AO PROCEDIMENTO SOLICITADO
3086,TRATAMENTO ODONTOL√ìGICO N√ÉO CARACTERIZADO COMO URG√äNCIA.
3087,COBRAN√áA INDEVIDA DE TAXA ADMINISTRATIVA
3088,"VALOR ACATADO CONFORME REAJUSTE RETROATIVO"
3089,QUANTIDADE DE ITENS INCOMPAT√çVEL COM O PER√çODO DE INTERNA√á√ÉO
3090,NECESS√ÅRIO ENVIAR AS ETIQUETAS E SELOS HEMOTER√ÅPICOS DO MATERIAL UTILIZADO
3091,COBRAN√áA FORA DO PRAZO ESTIPULADO NO CONTRATO
3092,"VALOR ACATADO POR GLOSA REALIZADA INDEVIDAMENTE AP√ìS AVALIA√á√ÉO DO RECURSO"
3093,VALOR ACATADO POR AUTORIZA√á√ÉO ESPECIAL
3094,VALOR DA TAXA ADMINISTRATIVA ALTERADO EM RAZ√ÉO DE GLOSAS
3095,RECURSO DE GLOSA ACATADO
3096,ATENDIMENTO N√ÉO CONFIRMADO PELO BENEFICI√ÅRIO
3097,TIPO DE ATENDIMENTO INCOMPAT√çVEL COM A SEGMENTA√á√ÉO ASSISTENCIAL CONTRATADA
3098,O PRESTADOR POSSUI PACOTE CONTRATADO PARA ESTE PROCEDIMENTO. VERIFIQUE O C√ìDIGO CORRESPONDENTE
3100,"PARA LIBERAR ESTE ACESSO ENTRE EM CONTATO COM A OPERADORA E SOLICITE O CADASTRAMENTO DO SEU C√ìDIGO DE ORIGEM"
3101,O PROCEDIMENTO SOLICITADO √â DE EXECU√á√ÉO √öNICA E J√Å FOI REALIZADO PELO BENEFICI√ÅRIO
3102,√â NECESS√ÅRIO TER UM PROCEDIMENTO RELACIONADO √Ä SOLICITA√á√ÉO
3103,SOLICITA√á√ÉO DE AUTORIZA√á√ÉO FORA DO PRAZO ACORDADO
3104,"RECUSADO CONFORME JUNTA M√âDICA/ODONTOL√ìGICA"
3105,ITEM COM UTILIZA√á√ÉO SUSPENSA PELO √ìRG√ÉO COMPETENTE
3106,REGISTRO ANVISA INV√ÅLIDO OU N√ÉO INFORMADO
3107,ITEM CATEGORIZADO COMO N√ÉO DESCART√ÅVEL
3108,ITEM INCLUSO NO PACOTE NEGOCIADO
3109,PROCEDIMENTO SOLICITADO N√ÉO AUTORIZADO POR N√ÉO CONSTAR DO ROL DE PROCEDIMENTOS E EVENTOS EM SA√öDE DA ANS
3110,BLOQUEIO JUDICIAL
3111,CAMPO CONDICIONADO N√ÉO PREENCHIDO OU INCORRETO
3112,DESCONTO DE COPARTICIPA√á√ÉO/FRANQUIA CONFORME CONTRATO
3113,NECESS√ÅRIO ENVIO DE  RADIOGRAFIA  PERIAPICAL DA REGI√ÉO
3114,NECESS√ÅRIO ENVIO DE RADIOGRAFIA INTERPROXIMAL DA REGI√ÉO
3115,NECESS√ÅRIO ENVIO DE RADIOGRAFIA OCLUSAL DA REGI√ÉO
3116,REALIZA√á√ÉO DE PROCEDIMENTO COM NECESSIDADE EST√âTICA
3117,PROCEDIMENTO ODONTOL√ìGICO COM INDICA√á√ÉO T√âCNICA EM PROGN√ìSTICO DESFAVOR√ÅVEL
3118,NECESS√ÅRIO ENVIAR TERMO DE CONSENTIMENTO INFORMADO
3119,NECESS√ÅRIO ENVIAR TERMO DE RESPONSABILIDADE PROFISSIONAL
3120,NECESS√ÅRIO O ENVIO DO PEDIDO DO PROFISSIONAL SOLICITANTE
3121,ITEM AUTORIZADO E AINDA N√ÉO INDENIZADO
3122,SOLICITA√á√ÉO DE REEMBOLSO EM PLANO SEM DIREITO √Ä LIVRE ESCOLHA
3123,ITEM PARA A MESMA FINALIDADE J√Å AUTORIZADO
3124,RADIOGRAFIA SUGERE INDICA√á√ÉO DE EXODONTIA
3125,RADIOGRAFIA SUGERE INDICA√á√ÉO DE RETRATAMENTO ENDODONTICO
3126,COBRAN√áA DE ITEM ANTERIOR √Ä DATA DE REALIZA√á√ÉO
3127,IMAGEM SUGERE ALTERA√á√ÉO PATOL√ìGICA
3128,IMAGEM SUGERE PRESEN√áA DE ARTEFATO DE IMAGEM
3129,IMAGEM SUGERE PRESEN√áA DE CORPO ESTRANHO
3130,IMAGEM SUGERE IMPLANTE EM PROCESSO DE OSSEOINTEGRA√á√ÉO
3131,ENVIAR PLANO DE TRATAMENTO ORTOD√îNTICO INICIAL
3132,ENVIAR PLANO DE TRATAMENTO ORTOD√îNTICO INTERMEDI√ÅRIO
3133,TRATAMENTO ORTOD√îNTICO CONCLU√çDO
3134,TRATAMENTO ORTOD√îNTICO EM  FASE DE CONTEN√á√ÉO
3135,PROFISSIONAL INFORMADO PARA REEMBOLSO PERTENCE A REDE DA OPERADORA
3136,PROCEDIMENTO OU ITEM ASSISTENCIAL AUTORIZADO
3137,PROCEDIMENTO PREV√ä COPARTICIPA√á√ÉO/FRANQUIA CONFORME CONTRATO
3138,CONDI√á√ÉO CL√çNICA INCOMPAT√çVEL COM A SOLICITA√á√ÉO
3139,TRATAMENTO ORTODONTICO SUSPENSO A PEDIDO DO DENTISTA
3140,ABANDONO DE TRATAMENTO PELO BENEFICI√ÅRIO
3141,BENEFICI√ÅRIO N√ÉO POSSUI COBERTURA PARA ASSIST√äNCIA AMBULATORIAL
3142,ITEM N√ÉO CONTRATADO
3143,VALOR ACATADO POR DECIS√ÉO JUDICIAL /LIMINAR
3144,N√ÉO √â NECESS√ÅRIA AUTORIZA√á√ÉO PR√âVIA
3145,N√ÉO AUTORIZADO POR MOTIVO T√âCNICO
3146,"PRODUTO CONTRATADO N√ÉO ADAPTADO √Ä LEI 9.656/98 SEM COBERTURA CONTRATUAL PARA O ITEM SOLICITADO"
3147,MATERIAL PASS√çVEL DE REPROCESSAMENTO
3148,TIPO DE TRANSA√á√ÉO INV√ÅLIDO
3149,INDICADOR DE ENVIO EM PAPEL INV√ÅLIDO
3150,C√ìDIGO DA TABELA INV√ÅLIDO
3151,O ESTABELECIMENTO DE SA√öDE PARA O QUAL FOI SOLICITADA A INFORMA√á√ÉO SOBRE PARTOS N√ÉO POSSU√çA V√çNCULO COM A OPERADORA NO PER√çODO A QUE SE REFERE A INFORMA√á√ÉO
3152,O PROFISSIONAL PARA O QUAL FOI SOLICITADA A INFORMA√á√ÉO SOBRE PARTOS N√ÉO POSSU√çA V√çNCULO COM A OPERADORA NO PER√çODO A QUE SE REFERE A INFORMA√á√ÉO
3153,O ESTABELECIMENTO DE SA√öDE PARA O QUAL FOI SOLICITADA A INFORMA√á√ÉO SOBRE PARTOS N√ÉO POSSUI V√çNCULO COM A OPERADORA
3154,O PROFISSIONAL PARA O QUAL FOI SOLICITADA A INFORMA√á√ÉO SOBRE PARTOS N√ÉO POSSUI V√çNCULO COM A OPERADORA
3155,PARTOGRAMA OU RELAT√ìRIO M√âDICO N√ÉO DISPON√çVEL PARA CONSULTA DA OPERADORA
5001,MENSAGEM ELETR√îNICA FORA DO PADR√ÉO TISS
5002,N√ÉO FOI POSS√çVEL VALIDAR O ARQUIVO XML
5003,ENDERE√áO DO REMETENTE INV√ÅLIDO
5004,ENDERE√áO DO DESTINAT√ÅRIO INV√ÅLIDO
5005,REMETENTE N√ÉO IDENTIFICADO
5006,DESTINAT√ÅRIO N√ÉO IDENTIFICADO
5007,MENSAGEM INCONSISTENTE OU INCOMPLETA
5008,ESPA√áO RESERVADO PARA A CAIXA DE SA√çDA INSUFICIENTE
5009,ESPA√áO RESERVADO PARA A CAIXA DE ENTRADA INSUFICIENTE
5010,ENVIO DE MENSAGEM N√ÉO FOI TERMINADO
5011,ENVIO DE MENSAGEM FINALIZADA
5012,RECEBIMENTO DE MENSAGEM N√ÉO FINALIZADO
5013,RECEBIMENTO DE MENSAGEM FINALIZADA
5014,C√ìDIGO HASH INV√ÅLIDO. MENSAGEM PODE ESTAR CORROMPIDA.
5015,N√öMERO DE GUIAS/DEMONSTRATIVOS DENTRO DA MENSAGEM SUPERIOR AO TAMANHO M√ÅXIMO PERMITIDO.
5016,SEM NENHUMA OCORRENCIA DE MOVIMENTO NA COMPETENCIA PARA ENVIO A ANS
5017,ARQUIVO PROCESSADO PELA ANS
5018,CERTIFICADO DIGITAL INV√ÅLIDO
5019,CERTIFICADO DIGITAL VENCIDO
5020,CERTIFICADO DIGITAL REVOGADO
5021,CADEIA DE CERTIFICA√á√ÉO INV√ÅLIDA
5022,ASSINATURA DIGITAL N√ÉO CONFERE
5023,COMPET√äNCIA N√ÉO EST√Å LIBERADA PARA ENVIO DE DADOS
5024,OPERADORA INATIVA NA COMPET√äNCIA DOS DADOS
5025,DATA DE REGISTRO DA TRANSA√á√ÉO INV√ÅLIDA
5026,HORA DE REGISTRO DA TRANSA√á√ÉO INV√ÅLIDA
5027,REGISTRO ANS DA OPERADORA INV√ÅLIDO
5028,VERS√ÉO DO PADR√ÉO INV√ÅLIDA
5029,INDICADOR INV√ÅLIDO
5030,C√ìDIGO DO MUN√çCIPIO INV√ÅLIDO
5031,CAR√ÅTER DE ATENDIMENTO INV√ÅLIDO
5032,INDICADOR DE REC√âM-NATO INV√ÅLIDO
5033,MOTIVO DE ENCERRAMENTO INV√ÅLIDO
5034,VALOR N√ÉO INFORMADO
5035,C√ìDIGO DA TABELA DE REFER√äNCIA N√ÉO INFORMADO
5036,C√ìDIGO DO GRUPO DO PROCEDIMENTO INV√ÅLIDO
5037,C√ìDIGO DO DENTE INV√ÅLIDO
5038,C√ìDIGO DA REGI√ÉO DA BOCA INV√ÅLIDO
5039,C√ìDIGO DA FACE DO DENTE INV√ÅLIDO
5040,VALOR DEVE SER MAIOR QUE ZERO
5041,QUANTIDADE N√ÉO INFORMADA
5042,VALOR INFORMADO DA GUIA DIFERENTE DO SOMAT√ìRIO DO VALOR INFORMADO DOS ITENS
5043,MOTIVO INV√ÅLIDO
5044,J√Å EXISTEM INFORMA√á√ïES NA ANS PARA A COMPET√äNCIA INFORMADA
5045,COMPET√äNCIA ANTERIOR N√ÉO ENVIADA
5046,COMPET√äNCIA INV√ÅLIDA
5047,N√öMERO DO LOTE N√ÉO INFORMADO
5048,DATA DE NASCIMENTO DO BENEFICI√ÅRIO INV√ÅLIDA
5049,VALOR TOTAL MENOR QUE ZERO NA GUIA
5050,VALOR INFORMADO INV√ÅLIDO
5051,COMPETENCIA DO ARQUIVO DIFERENTE DA COMPETENCIA DA DATA DE PROCESSAMENTO DO LAN√áAMENTO
5052,IDENTIFICADOR INEXISTENTE
5053,IDENTIFICADOR J√Å INFORMADO
5054,IDENTIFICADOR N√ÉO ENCONTRADO
5055,IDENTIFICADOR J√Å INFORMADO NA COMPET√äNCIA
5056,IDENTIFICADOR N√ÉO INFORMADO NA COMPET√äNCIA
5057,GUIA DE CONSULTA COM MAIS DE UM PROCEDIMENTO
5058,PROCEDIMENTO INCOMPAT√çVEL COM O TIPO DE GUIA
5059,EXCLUS√ÉO INV√ÅLIDA - EXISTEM LAN√áAMENTOS VINCULADOS A ESTA FORMA DE CONTRATA√á√ÉO
5060,VALOR TOTAL PAGO DIFERENTE DA SOMA DAS PARCELAS PAGAS NO LAN√áAMENTO
5061,TIPO DE ATENDIMENTO OPERADORA INTERMEDI√ÅRIA N√ÉO INFORMADO
5062,REGISTRO ANS DA OPERADORA INTERMEDI√ÅRIA N√ÉO INFORMADO
3156,Token inv√°lido
3157,QR code inv√°lido
3158,Biometria ‚Äì falha na transmiss√£o
3159,Biometria ‚Äì n√£o compat√≠vel
3160,Time Out - tente novamente
3161,Prazo de envio fora do per√≠odo contratual acordado entre as partes
3162,C√≥digo do protocolo n√£o encontrado
3163,N√£o necessita de imagem
3164,Arquivo enviado n√£o √© de imagem
3165,Arquivo de imagem corrompido
3166,Arquivo enviado excede o tamanho m√°ximo permitido
3167,SEQUENCIAL INV√ÅLIDO
3168,ASSINATURA DIGITAL INV√ÅLIDA OU N√ÉO ENVIADA
5063,PAR CNPJ x CNES NAO ENCONTRADO NA BASE DO CNES
5064,TIPO DE ESTABELECIMENTO NO CNES N√ÉO √â APTO PARA INTERNA√á√ÉO
5065,TIPO DE ATIVIDADE ECONOMICA DO CNPJ N√ÉO √â APTO PARA INTERNA√á√ÉO
5066,N√öMERO DA DECLARA√á√ÉO EM DUPLICIDADE.
5067,DIAGN√ìSTICO EM DUPLICIDADE
5068,DECLARA√á√ÉO DIFERENTE DO LAN√áAMENTO ANTERIOR DA GUIA
5069,C√ìDIGO DO DENTE DIFERENTE DO LAN√áAMENTO ANTERIOR DA GUIA
5070,C√ìDIGO DA REGI√ÉO DA BOCA DIFERENTE DO LAN√áAMENTO ANTERIOR DA GUIA
5071,C√ìDIGO DA FACE DO DENTE DIFERENTE DO LAN√áAMENTO ANTERIOR DA GUIA
5072,VALOR INFORMADO DIFERENTE DO LAN√áAMENTO ANTERIOR DA GUIA
5073,O PRIMEIRO LANCAMENTO DA GUIA S√ì PODE SER EXCLUIDO SE ELE FOR O √öNICO
5074,REGIME DE ATENDIMENTO INV√ÅLIDO
5075,CID DIFERENTE DO LAN√áAMENTO ANTERIOR DA GUIA
5076,CPF N√ÉO ENCONTRADO NA RECEITA FEDERAL
5077,SEXO NA RECEITA FEDERAL DIFERENTE DO INFORMADO PARA O CPF
5078,DATA DE NASCIMENTO NA RECEITA FEDERAL DIFERENTE DA INFORMADA PARA O CPF
5079,MODELO DE REMUNERA√á√ÉO EM DUPLICIDADE.
5080,MODELO DE REMUNERA√á√ÉO N√ÉO INFORMADO
5081,MODELO DE REMUNERA√á√ÉO N√ÉO DEVE SER INFORMADO PARA REEMBOLSO/PRESTADOR EVENTUAL
5082,MODELO DE REMUNERA√á√ÉO N√ÉO DEVE SER INFORMADO PARA REDE PROPRIA COM MESMO CNPJ
5083,SOMA DOS VALORES DOS MODELOS DE REMUNERA√á√ÉO DIFERENTE DO VALOR INFORMADO DA GUIA
5084,UNIDADE DE MEDIDA N√ÉO DEVE SER PREENCHIDA PARA A TABELA TUSS INFORMADA
5085,UNIDADE DE MEDIDA √â OBRIGAT√ìRIA PARA A TABELA TUSS INFORMADA
5086,DADO DIVERGENTE COM A RECEITA FEDERAL PARA ESTE CNS (CPF/SEXO/DATA NASCIMENTO)"""
    
    data_file = io.StringIO(csv_data)
    df = pd.read_csv(data_file)
    return df

#================================================================================
# FUN√á√ïES DE PARSE (FASE 1 e FASE 2)
#================================================================================

@st.cache_data
def parse_xte(file):
    # Esta fun√ß√£o n√£o foi alterada
    file.seek(0)
    content = file.read().decode('iso-8859-1')
    tree = ET.ElementTree(ET.fromstring(content))
    root = tree.getroot()
    ns = {'ans': 'http://www.ans.gov.br/padroes/tiss/schemas'}
    all_data = []
    
    cabecalho_info = {}
    cabecalho = root.find('.//ans:cabecalho', namespaces=ns)
    if cabecalho is not None:
        identificacao = cabecalho.find('ans:identificacaoTransacao', namespaces=ns)
        if identificacao is not None:
            cabecalho_info['tipoTransacao'] = identificacao.findtext('ans:tipoTransacao', default='', namespaces=ns)
            cabecalho_info['numeroLote'] = identificacao.findtext('ans:numeroLote', default='', namespaces=ns)
            cabecalho_info['competenciaLote'] = identificacao.findtext('ans:competenciaLote', default='', namespaces=ns)
            cabecalho_info['dataRegistroTransacao'] = identificacao.findtext('ans:dataRegistroTransacao', default='', namespaces=ns)
            cabecalho_info['horaRegistroTransacao'] = identificacao.findtext('ans:horaRegistroTransacao', default='', namespaces=ns)
        cabecalho_info['registroANS'] = cabecalho.findtext('ans:registroANS', default='', namespaces=ns)
        cabecalho_info['versaoPadrao'] = cabecalho.findtext('ans:versaoPadrao', default='', namespaces=ns)

    for guia in root.findall(".//ans:guiaMonitoramento", namespaces=ns):
        guia_data = {}
        guia_data.update(cabecalho_info)

        for elem in guia.iter():
            tag_full = elem.tag.split('}')[-1]
            if 'data' in tag_full.lower() and elem.text:
                try:
                    date_obj = datetime.strptime(elem.text, '%Y-%m-%d')
                    guia_data[tag_full] = date_obj.strftime('%d/%m/%Y')
                except ValueError:
                    guia_data[tag_full] = elem.text
            else:
                guia_data[tag_full] = elem.text if elem.text else None

        procedimentos = guia.findall(".//ans:procedimentos", namespaces=ns)
        if procedimentos:
            for proc in procedimentos:
                proc_data = guia_data.copy()
                proc_data['codigoProcedimento'] = (proc.findtext('ans:identProcedimento/ans:Procedimento/ans:codigoProcedimento', namespaces=ns) or '').strip()
                proc_data['grupoProcedimento'] = (proc.findtext('ans:identProcedimento/ans:Procedimento/ans:grupoProcedimento', namespaces=ns) or '').strip()
                proc_data['valorInformado'] = (proc.findtext('ans:valorInformado', namespaces=ns) or '').strip()
                proc_data['valorPagoProc'] = (proc.findtext('ans:valorPagoProc', namespaces=ns) or '').strip()
                campos_procedimento = ['quantidadeInformada', 'quantidadePaga', 'valorPagoFornecedor', 'valorCoParticipacao', 'unidadeMedida']
                for campo in campos_procedimento:
                    proc_data[campo] = (proc.findtext(f'ans:{campo}', namespaces=ns) or '').strip()
                proc_data['codigoTabela'] = (proc.findtext('ans:identProcedimento/ans:codigoTabela', namespaces=ns) or '').strip()
                proc_data['registroANSOperadoraIntermediaria'] = (proc.findtext('ans:registroANSOperadoraIntermediaria', namespaces=ns) or '').strip()
                proc_data['tipoAtendimentoOperadoraIntermediaria'] = (proc.findtext('ans:tipoAtendimentoOperadoraIntermediaria', namespaces=ns) or '').strip()
                all_data.append(proc_data)
        else:
            all_data.append(guia_data)

    df = pd.DataFrame(all_data)
    df['Nome da Origem'] = file.name

    date_columns = [col for col in df.columns if 'data' in col.lower()]
    for col in date_columns:
        try:
            df[col] = pd.to_datetime(df[col], dayfirst=True, errors='coerce').dt.strftime('%d/%m/%Y')
        except Exception:
            pass

    if 'dataRealizacao' in df.columns and 'dataNascimento' in df.columns:
        def calcular_idade(row):
            try:
                data_realizacao = datetime.strptime(row['dataRealizacao'], '%d/%m/%Y')
                data_nascimento = datetime.strptime(row['dataNascimento'], '%d/%m/%Y')
                return (data_realizacao - data_nascimento).days // 365
            except Exception:
                return None
        df['Idade_na_Realiza√ß√£o'] = df.apply(calcular_idade, axis=1)

    df.rename(columns={
        'valorInformado': 'valorInformado_proc',
        'valorPagoFornecedor': 'valorPagoFornecedor_proc',
        'dataRegistroTransacao': 'dataRegistroTransacao_cabecalho',
        'horaRegistroTransacao': 'horaRegistroTransacao_cabecalho',
        'registroANS': 'registroANS_cabecalho',
        'versaoPadrao': 'versaoPadrao_cabecalho'
    }, inplace=True)

    colunas_finais = [
        'Nome da Origem', 'tipoRegistro', 'versaoTISSPrestador', 'formaEnvio', 'tipoTransacao',
        'numeroLote', 'competenciaLote', 'dataRegistroTransacao_cabecalho', 'horaRegistroTransacao_cabecalho',
        'registroANS_cabecalho', 'versaoPadrao_cabecalho', 'CNES', 'identificadorExecutante',
        'codigoCNPJ_CPF', 'municipioExecutante', 'registroANSOperadoraIntermediaria',
        'tipoAtendimentoOperadoraIntermediaria', 'numeroCartaoNacionalSaude', 'cpfBeneficiario',
        'sexo', 'dataNascimento', 'municipioResidencia', 'numeroRegistroPlano',
        'tipoEventoAtencao', 'origemEventoAtencao', 'numeroGuia_prestador', 'numeroGuia_operadora',
        'identificacaoReembolso', 'formaRemuneracao', 'valorRemuneracao', 'guiaSolicitacaoInternacao',
        'dataSolicitacao', 'numeroGuiaSPSADTPrincipal', 'dataAutorizacao', 'dataRealizacao',
        'dataFimPeriodo','dataInicialFaturamento', 'dataProtocoloCobranca', 'dataPagamento', 'dataProcessamentoGuia',
        'tipoConsulta', 'cboExecutante', 'indicacaoRecemNato', 'indicacaoAcidente',
        'caraterAtendimento', 'tipoInternacao', 'regimeInternacao', 'tipoAtendimento',
        'regimeAtendimento', 'tipoFaturamento', 'diariasAcompanhante', 'diariasUTI', 'motivoSaida',
        'valorTotalInformado', 'valorProcessado', 'valorTotalPagoProcedimentos', 'valorTotalDiarias',
        'valorTotalTaxas', 'valorTotalMateriais', 'valorTotalOPME', 'valorTotalMedicamentos',
        'valorGlosaGuia', 'valorPagoGuia', 'valorPagoFornecedores', 'valorTotalTabelaPropria',
        'valorTotalCoParticipacao', 'declaracaoNascido', 'declaracaoObito', 'codigoTabela',
        'grupoProcedimento', 'codigoProcedimento', 'quantidadeInformada','valorInformado', 'valorInformado_proc',
        'valorPagoFornecedor','quantidadePaga', 'unidadeMedida','valorCoParticipacao', 'valorPagoProc', 'valorPagoFornecedor_proc',
        'Idade_na_Realiza√ß√£o', 'diagnosticoCID'
    ]

    for col in colunas_finais:
        if col not in df.columns:
            df[col] = None
    
    df = df[colunas_finais]
    return df, content, tree

@st.cache_data
def parse_xtr(file):
    # Esta fun√ß√£o n√£o foi alterada
    file.seek(0)
    content = file.read().decode('iso-8859-1')
    tree = ET.ElementTree(ET.fromstring(content))
    root = tree.getroot()
    ns = {'ans': 'http://www.ans.gov.br/padroes/tiss/schemas'}
    
    all_errors = []

    caminho_das_guias = './/ans:resumoProcessamento/ans:registrosRejeitados/ans:guiaMonitoramento'

    for guia_rejeitada in root.findall(caminho_das_guias, namespaces=ns):
        guia_info = {
            'nomeArquivo_xtr': file.name,
            'numeroGuiaOperadora_xtr': guia_rejeitada.findtext('ans:numeroGuiaOperadora', default='', namespaces=ns).strip()
        }

        erros_na_guia = []
        
        for erro in guia_rejeitada.findall('ans:errosGuia', namespaces=ns):
            erros_na_guia.append({
                'codigoErro': erro.findtext('ans:codigoErro', default='', namespaces=ns).strip(),
                'identificadorCampo': erro.findtext('ans:identificadorCampo', default='', namespaces=ns).strip()
            })

        for item_erro in guia_rejeitada.findall('ans:errosItensGuia', namespaces=ns):
            for relacao_erro in item_erro.findall('ans:relacaoErros', namespaces=ns):
                 erros_na_guia.append({
                    'codigoErro': relacao_erro.findtext('ans:codigoErro', default='', namespaces=ns).strip(),
                    'identificadorCampo': relacao_erro.findtext('ans:identificadorCampo', default='', namespaces=ns).strip()
                })

        for erro_item in erros_na_guia:
            linha_completa = guia_info.copy()
            linha_completa.update(erro_item)
            all_errors.append(linha_completa)
            
    df_errors = pd.DataFrame(all_errors)
    return df_errors


#================================================================================
# INTERFACE GR√ÅFICA (STREAMLIT)
#================================================================================

st.set_page_config(page_title="Analisador TISS", layout="wide")

st.markdown("""
    <style>
        section[data-testid="stSidebar"] .css-ng1t4o {
            background-color: #1e1e1e;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
        }
        section[data-testid="stSidebar"] label {
            color: white !important;
        }
    </style>
""", unsafe_allow_html=True)

st.sidebar.title("AM Consultoria | Ferramenta TISS")
st.sidebar.markdown("---")
st.sidebar.info("Vers√£o de Demonstra√ß√£o")

st.title("Analisador de Erros TISS")

#-------------------------------------------------------------------------------
# P√ÅGINA √öNICA: AN√ÅLISE DE ERROS
#-------------------------------------------------------------------------------
st.subheader("üîç An√°lise de Erros do Retorno da ANS (XTR)")
st.markdown("""
Esta ferramenta cruza os dados de um arquivo de retorno (`.XTR`) com os dados originais (`.XTE`) para gerar um relat√≥rio de an√°lise focado **apenas nas guias com erro**. A lista de erros da ANS j√° est√° integrada.

**Siga os passos:**
1.  Fa√ßa o upload do(s) arquivo(s) `.XTE` que voc√™ enviou. 
2.  Fa√ßa o upload do(s) arquivo(s) de retorno `.XTR` correspondente(s).
3.  Clique em "Analisar Erros" para gerar o relat√≥rio consolidado.
""")

col1, col2 = st.columns(2)
with col1:
    uploaded_xte_files = st.file_uploader("1. Arquivos de Envio (.xte)", accept_multiple_files=True, type=["xte"])
with col2:
    uploaded_xtr_files = st.file_uploader("2. Arquivos de Retorno (.xtr)", accept_multiple_files=True, type=["xtr"])

if st.button("Analisar Erros", type="primary"):
    if not uploaded_xte_files or not uploaded_xtr_files:
        st.warning("Por favor, fa√ßa o upload dos arquivos XTE e XTR para a an√°lise.")
    else:
        try:
            progress_bar = st.progress(0)
            st.markdown("---")
            
            # --- ESTRUTURA DE LOGS PERSISTENTES E DOWNLOADS ---
            log_container = st.container()
            log_leitura_xte = log_container.empty()
            download_xte_placeholder = log_container.empty()
            log_leitura_xtr = log_container.empty()
            download_xtr_placeholder = log_container.empty()
            status_placeholder = log_container.empty()

            # Passo 1: Consolidar XTE
            log_leitura_xte.info("Passo 1: Consolidando arquivos de envio (.xte)... ‚è≥")
            df_xte_list = [parse_xte(f)[0] for f in uploaded_xte_files]
            df_xte_full = pd.concat(df_xte_list, ignore_index=True)
            progress_bar.progress(14)
            log_leitura_xte.success(f"Passo 1: Arquivos XTE consolidados! ‚úÖ ({len(df_xte_full)} registros)")
            
            excel_buffer_xte = io.BytesIO()
            df_xte_full.to_excel(excel_buffer_xte, index=False, engine='xlsxwriter')
            download_xte_placeholder.download_button(
                label="‚¨á Baixar Planilha Consolidada XTE",
                data=excel_buffer_xte.getvalue(),
                file_name="dados_consolidados_xte.xlsx",
                mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
            )
            time.sleep(1)

            # Passo 2: Consolidar XTR
            log_leitura_xtr.info("Passo 2: Consolidando arquivos de retorno (.xtr)... ‚è≥")
            df_xtr_list = [parse_xtr(f) for f in uploaded_xtr_files]
            df_xtr_full = pd.concat(df_xtr_list, ignore_index=True)
            progress_bar.progress(28)
            log_leitura_xtr.success(f"Passo 2: Arquivos XTR consolidados! ‚úÖ ({len(df_xtr_full)} erros reportados)")

            excel_buffer_xtr = io.BytesIO()
            df_xtr_full.to_excel(excel_buffer_xtr, index=False, engine='xlsxwriter')
            download_xtr_placeholder.download_button(
                label="‚¨á Baixar Planilha de Erros XTR",
                data=excel_buffer_xtr.getvalue(),
                file_name="erros_consolidados_xtr.xlsx",
                mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
            )
            time.sleep(1)
            
            # Passo 3: Carregar Padr√£o ANS
            status_placeholder.info("Passo 3/7: Carregando padr√£o de erros da ANS... ‚è≥")
            df_ans_errors = carregar_erros_ans()
            df_ans_errors.rename(columns={'C√≥digo do Termo': 'codigoErro', 'Termo': 'descricaoErro'}, inplace=True)
            df_ans_errors['codigoErro'] = df_ans_errors['codigoErro'].astype(str)
            progress_bar.progress(42)
            status_placeholder.success("Passo 3/7: Padr√£o de erros carregado! ‚úÖ")
            time.sleep(1)

            # Passo 4: Preparar Chaves de Cruzamento
            status_placeholder.info("Passo 4/7: Preparando chaves de cruzamento nos dados... ‚è≥")
            df_xte_full['nomeArquivo_base'] = df_xte_full['Nome da Origem'].apply(lambda x: os.path.splitext(x)[0])
            df_xte_full['chave_cruzamento'] = df_xte_full['nomeArquivo_base'].astype(str) + "_" + df_xte_full['numeroGuia_operadora'].astype(str)
            if not df_xtr_full.empty:
                df_xtr_full['nomeArquivo_base'] = df_xtr_full['nomeArquivo_xtr'].apply(lambda x: os.path.splitext(x)[0])
                df_xtr_full['chave_cruzamento'] = df_xtr_full['nomeArquivo_base'].astype(str) + "_" + df_xtr_full['numeroGuiaOperadora_xtr'].astype(str)
            progress_bar.progress(56)
            status_placeholder.success("Passo 4/7: Chaves de cruzamento preparadas! ‚úÖ")
            time.sleep(1)
            
            # Passo 5: Transformar Erros em Colunas (Pivot)
            status_placeholder.info("Passo 5/7: Transformando lista de erros em colunas...")
            if not df_xtr_full.empty:
                erros_pivot = df_xtr_full.pivot_table(
                    index='chave_cruzamento', 
                    columns='codigoErro', 
                    values='identificadorCampo',
                    aggfunc='first'
                ).reset_index()
                
                error_map = pd.Series(df_ans_errors.descricaoErro.values, index=df_ans_errors.codigoErro).to_dict()

                colunas_renomeadas = {'chave_cruzamento': 'chave_cruzamento'}
                for col in erros_pivot.columns:
                    if col != 'chave_cruzamento':
                        colunas_renomeadas[col] = f'Campo_Erro_{col}'
                        descricao = error_map.get(col, f'Descri√ß√£o n√£o encontrada para {col}')
                        erros_pivot[f'Erro_{col}'] = erros_pivot[col].apply(lambda x: descricao if pd.notna(x) else pd.NA)

                erros_pivot.rename(columns=colunas_renomeadas, inplace=True)
            else:
                erros_pivot = pd.DataFrame(columns=['chave_cruzamento'])
            progress_bar.progress(70)
            status_placeholder.success("Passo 5/7: Lista de erros transformada! ‚úÖ")
            time.sleep(1)

            # Passo 6: Juntar Dados Originais com Erros (INNER JOIN)
            status_placeholder.info("Passo 6/7: Filtrando apenas guias com erro (INNER JOIN)...")
            df_final = pd.merge(df_xte_full, erros_pivot, on='chave_cruzamento', how='inner')
            progress_bar.progress(85)
            status_placeholder.success(f"Passo 6/7: Guias com erro filtradas! ‚úÖ")
            time.sleep(1)

            # Passo 7: Organizar Relat√≥rio Final
            status_placeholder.info("Passo 7/7: Organizando o relat√≥rio final...")
            if not df_final.empty:
                # --- NOVA L√ìGICA DE REORDENA√á√ÉO DE COLUNAS ---
                original_cols = list(df_xte_full.columns.drop(['nomeArquivo_base', 'chave_cruzamento']))
                error_cols = [col for col in df_final.columns if 'Erro_' in col or 'Campo_Erro_' in col]
                
                # Extrai os c√≥digos de erro √∫nicos e os ordena numericamente para garantir uma ordem consistente
                unique_error_codes = sorted(list(set([col.split('_')[-1] for col in error_cols])), key=int)
                
                # Cria a lista de colunas de erro na ordem desejada (Par: Campo, Erro)
                sorted_error_cols = []
                for code in unique_error_codes:
                    campo_col = f'Campo_Erro_{code}'
                    erro_col = f'Erro_{code}'
                    if campo_col in df_final.columns:
                        sorted_error_cols.append(campo_col)
                    if erro_col in df_final.columns:
                        sorted_error_cols.append(erro_col)
                        
                # Combina as colunas originais com as colunas de erro reordenadas
                final_cols_order = original_cols + sorted_error_cols
                df_final = df_final[final_cols_order]

            progress_bar.progress(100)
            status_placeholder.success("Passo 7/7: Relat√≥rio final organizado! ‚úÖ")
            time.sleep(1.5)
            
            status_placeholder.empty()
            
            if df_final.empty:
                st.error("Nenhuma correspond√™ncia de guia com erro encontrada. Verifique se os nomes dos arquivos XTE e XTR correspondem.")
            else:
                st.success(f"üéâ An√°lise conclu√≠da! Foram encontradas {len(df_final)} linhas de procedimento nas guias com erro.")
                st.markdown("Abaixo est√° uma **pr√©-visualiza√ß√£o** do resultado:")
                st.dataframe(df_final)
                
                st.markdown("---")
                with st.spinner('Preparando sua planilha para download... ‚è≥'):
                    excel_buffer_final = io.BytesIO()
                    df_final.to_excel(excel_buffer_final, index=False, engine='xlsxwriter')
                    time.sleep(1) 
                
                st.download_button(
                    label="‚¨á Baixar Planilha de An√°lise Completa (.xlsx)",
                    data=excel_buffer_final.getvalue(),
                    file_name="analise_de_erros_TISS_wide.xlsx",
                    mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                    type="primary"
                )
            
        except Exception as e:
            st.error(f"Ocorreu um erro durante a an√°lise: {e}")
            st.error("Verifique se os arquivos est√£o no formato correto.")
